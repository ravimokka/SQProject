{"ast":null,"code":"/**\n* Copyright 2012-2019, Plotly, Inc.\n* All rights reserved.\n*\n* This source code is licensed under the MIT license found in the\n* LICENSE file in the root directory of this source tree.\n*/\n'use strict';\n\nvar Registry = require('../registry');\n\nvar Lib = require('../lib');\n\nvar extendFlat = Lib.extendFlat;\nvar extendDeep = Lib.extendDeep; // Put default plotTile layouts here\n\nfunction cloneLayoutOverride(tileClass) {\n  var override;\n\n  switch (tileClass) {\n    case 'themes__thumb':\n      override = {\n        autosize: true,\n        width: 150,\n        height: 150,\n        title: {\n          text: ''\n        },\n        showlegend: false,\n        margin: {\n          l: 5,\n          r: 5,\n          t: 5,\n          b: 5,\n          pad: 0\n        },\n        annotations: []\n      };\n      break;\n\n    case 'thumbnail':\n      override = {\n        title: {\n          text: ''\n        },\n        hidesources: true,\n        showlegend: false,\n        borderwidth: 0,\n        bordercolor: '',\n        margin: {\n          l: 1,\n          r: 1,\n          t: 1,\n          b: 1,\n          pad: 0\n        },\n        annotations: []\n      };\n      break;\n\n    default:\n      override = {};\n  }\n\n  return override;\n}\n\nfunction keyIsAxis(keyName) {\n  var types = ['xaxis', 'yaxis', 'zaxis'];\n  return types.indexOf(keyName.slice(0, 5)) > -1;\n}\n\nmodule.exports = function clonePlot(graphObj, options) {\n  // Polar plot compatibility\n  if (graphObj.framework && graphObj.framework.isPolar) {\n    graphObj = graphObj.framework.getConfig();\n  }\n\n  var i;\n  var oldData = graphObj.data;\n  var oldLayout = graphObj.layout;\n  var newData = extendDeep([], oldData);\n  var newLayout = extendDeep({}, oldLayout, cloneLayoutOverride(options.tileClass));\n  var context = graphObj._context || {};\n  if (options.width) newLayout.width = options.width;\n  if (options.height) newLayout.height = options.height;\n\n  if (options.tileClass === 'thumbnail' || options.tileClass === 'themes__thumb') {\n    // kill annotations\n    newLayout.annotations = [];\n    var keys = Object.keys(newLayout);\n\n    for (i = 0; i < keys.length; i++) {\n      if (keyIsAxis(keys[i])) {\n        newLayout[keys[i]].title = {\n          text: ''\n        };\n      }\n    } // kill colorbar and pie labels\n\n\n    for (i = 0; i < newData.length; i++) {\n      var trace = newData[i];\n      trace.showscale = false;\n      if (trace.marker) trace.marker.showscale = false;\n      if (Registry.traceIs(trace, 'pie-like')) trace.textposition = 'none';\n    }\n  }\n\n  if (Array.isArray(options.annotations)) {\n    for (i = 0; i < options.annotations.length; i++) {\n      newLayout.annotations.push(options.annotations[i]);\n    }\n  } // TODO: does this scene modification really belong here?\n  // If we still need it, can it move into the gl3d module?\n\n\n  var sceneIds = Object.keys(newLayout).filter(function (key) {\n    return key.match(/^scene\\d*$/);\n  });\n\n  if (sceneIds.length) {\n    var axesImageOverride = {};\n\n    if (options.tileClass === 'thumbnail') {\n      axesImageOverride = {\n        title: {\n          text: ''\n        },\n        showaxeslabels: false,\n        showticklabels: false,\n        linetickenable: false\n      };\n    }\n\n    for (i = 0; i < sceneIds.length; i++) {\n      var scene = newLayout[sceneIds[i]];\n\n      if (!scene.xaxis) {\n        scene.xaxis = {};\n      }\n\n      if (!scene.yaxis) {\n        scene.yaxis = {};\n      }\n\n      if (!scene.zaxis) {\n        scene.zaxis = {};\n      }\n\n      extendFlat(scene.xaxis, axesImageOverride);\n      extendFlat(scene.yaxis, axesImageOverride);\n      extendFlat(scene.zaxis, axesImageOverride); // TODO what does this do?\n\n      scene._scene = null;\n    }\n  }\n\n  var gd = document.createElement('div');\n  if (options.tileClass) gd.className = options.tileClass;\n  var plotTile = {\n    gd: gd,\n    td: gd,\n    // for external (image server) compatibility\n    layout: newLayout,\n    data: newData,\n    config: {\n      staticPlot: options.staticPlot === undefined ? true : options.staticPlot,\n      plotGlPixelRatio: options.plotGlPixelRatio === undefined ? 2 : options.plotGlPixelRatio,\n      displaylogo: options.displaylogo || false,\n      showLink: options.showLink || false,\n      showTips: options.showTips || false,\n      mapboxAccessToken: context.mapboxAccessToken\n    }\n  };\n\n  if (options.setBackground !== 'transparent') {\n    plotTile.config.setBackground = options.setBackground || 'opaque';\n  } // attaching the default Layout the gd, so you can grab it later\n\n\n  plotTile.gd.defaultLayout = cloneLayoutOverride(options.tileClass);\n  return plotTile;\n};","map":null,"metadata":{},"sourceType":"script"}