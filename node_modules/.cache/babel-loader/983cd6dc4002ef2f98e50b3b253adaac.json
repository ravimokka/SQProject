{"ast":null,"code":"/**\n* Copyright 2012-2019, Plotly, Inc.\n* All rights reserved.\n*\n* This source code is licensed under the MIT license found in the\n* LICENSE file in the root directory of this source tree.\n*/\n'use strict';\n\nvar Registry = require('../../registry');\n\nvar Lib = require('../../lib');\n/**\n * Factory function for checking component arrays for subplot references.\n *\n * @param {string} containerArrayName: the top-level array in gd.layout to check\n *   If an item in this container is found that references a cartesian x and/or y axis,\n *   ensure cartesian is marked as a base plot module and record the axes (and subplot\n *   if both refs are axes) in gd._fullLayout\n *\n * @return {function}: with args layoutIn (gd.layout) and layoutOut (gd._fullLayout)\n * as expected of a component includeBasePlot method\n */\n\n\nmodule.exports = function makeIncludeComponents(containerArrayName) {\n  return function includeComponents(layoutIn, layoutOut) {\n    var array = layoutIn[containerArrayName];\n    if (!Array.isArray(array)) return;\n    var Cartesian = Registry.subplotsRegistry.cartesian;\n    var idRegex = Cartesian.idRegex;\n    var subplots = layoutOut._subplots;\n    var xaList = subplots.xaxis;\n    var yaList = subplots.yaxis;\n    var cartesianList = subplots.cartesian;\n\n    var hasCartesianOrGL2D = layoutOut._has('cartesian') || layoutOut._has('gl2d');\n\n    for (var i = 0; i < array.length; i++) {\n      var itemi = array[i];\n      if (!Lib.isPlainObject(itemi)) continue;\n      var xref = itemi.xref;\n      var yref = itemi.yref;\n      var hasXref = idRegex.x.test(xref);\n      var hasYref = idRegex.y.test(yref);\n\n      if (hasXref || hasYref) {\n        if (!hasCartesianOrGL2D) Lib.pushUnique(layoutOut._basePlotModules, Cartesian);\n        var newAxis = false;\n\n        if (hasXref && xaList.indexOf(xref) === -1) {\n          xaList.push(xref);\n          newAxis = true;\n        }\n\n        if (hasYref && yaList.indexOf(yref) === -1) {\n          yaList.push(yref);\n          newAxis = true;\n        }\n        /*\n         * Notice the logic here: only add a subplot for a component if\n         * it's referencing both x and y axes AND it's creating a new axis\n         * so for example if your plot already has xy and x2y2, an annotation\n         * on x2y or xy2 will not create a new subplot.\n         */\n\n\n        if (newAxis && hasXref && hasYref) {\n          cartesianList.push(xref + yref);\n        }\n      }\n    }\n  };\n};","map":null,"metadata":{},"sourceType":"script"}