{"ast":null,"code":"/**\n* Copyright 2012-2019, Plotly, Inc.\n* All rights reserved.\n*\n* This source code is licensed under the MIT license found in the\n* LICENSE file in the root directory of this source tree.\n*/\n'use strict';\n\nvar isNumeric = require('fast-isnumeric');\n\nvar Lib = require('../../lib');\n\nvar BADNUM = require('../../constants/numerical').BADNUM;\n\nmodule.exports = function autoType(array, calendar, opts) {\n  opts = opts || {};\n  if (!opts.noMultiCategory && multiCategory(array)) return 'multicategory';\n  if (moreDates(array, calendar)) return 'date';\n  if (category(array)) return 'category';\n  if (linearOK(array)) return 'linear';else return '-';\n}; // is there at least one number in array? If not, we should leave\n// ax.type empty so it can be autoset later\n\n\nfunction linearOK(array) {\n  if (!array) return false;\n\n  for (var i = 0; i < array.length; i++) {\n    if (isNumeric(array[i])) return true;\n  }\n\n  return false;\n} // does the array a have mostly dates rather than numbers?\n// note: some values can be neither (such as blanks, text)\n// 2- or 4-digit integers can be both, so require twice as many\n// dates as non-dates, to exclude cases with mostly 2 & 4 digit\n// numbers and a few dates\n// as with categories, consider DISTINCT values only.\n\n\nfunction moreDates(a, calendar) {\n  // test at most 1000 points, evenly spaced\n  var inc = Math.max(1, (a.length - 1) / 1000);\n  var dcnt = 0;\n  var ncnt = 0;\n  var seen = {};\n\n  for (var i = 0; i < a.length; i += inc) {\n    var ai = a[Math.round(i)];\n    var stri = String(ai);\n    if (seen[stri]) continue;\n    seen[stri] = 1;\n    if (Lib.isDateTime(ai, calendar)) dcnt += 1;\n    if (isNumeric(ai)) ncnt += 1;\n  }\n\n  return dcnt > ncnt * 2;\n} // are the (x,y)-values in gd.data mostly text?\n// require twice as many DISTINCT categories as distinct numbers\n\n\nfunction category(a) {\n  // test at most 1000 points\n  var inc = Math.max(1, (a.length - 1) / 1000);\n  var curvenums = 0;\n  var curvecats = 0;\n  var seen = {};\n\n  for (var i = 0; i < a.length; i += inc) {\n    var ai = a[Math.round(i)];\n    var stri = String(ai);\n    if (seen[stri]) continue;\n    seen[stri] = 1;\n    if (typeof ai === 'boolean') curvecats++;else if (Lib.cleanNumber(ai) !== BADNUM) curvenums++;else if (typeof ai === 'string') curvecats++;\n  }\n\n  return curvecats > curvenums * 2;\n} // very-loose requirements for multicategory,\n// trace modules that should never auto-type to multicategory\n// should be declared with 'noMultiCategory'\n\n\nfunction multiCategory(a) {\n  return Lib.isArrayOrTypedArray(a[0]) && Lib.isArrayOrTypedArray(a[1]);\n}","map":null,"metadata":{},"sourceType":"script"}