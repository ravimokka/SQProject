{"ast":null,"code":"/**\n* Copyright 2012-2019, Plotly, Inc.\n* All rights reserved.\n*\n* This source code is licensed under the MIT license found in the\n* LICENSE file in the root directory of this source tree.\n*/\n'use strict';\n\nvar isNumeric = require('fast-isnumeric');\n\nvar toLogRange = require('../../lib/to_log_range');\n/*\n * convertCoords: when converting an axis between log and linear\n * you need to alter any annotations on that axis to keep them\n * pointing at the same data point.\n * In v2.0 this will become obsolete\n *\n * gd: the plot div\n * ax: the axis being changed\n * newType: the type it's getting\n * doExtra: function(attr, val) from inside relayout that sets the attribute.\n *     Use this to make the changes as it's aware if any other changes in the\n *     same relayout call should override this conversion.\n */\n\n\nmodule.exports = function convertCoords(gd, ax, newType, doExtra) {\n  ax = ax || {};\n  var toLog = newType === 'log' && ax.type === 'linear';\n  var fromLog = newType === 'linear' && ax.type === 'log';\n  if (!(toLog || fromLog)) return;\n  var annotations = gd._fullLayout.annotations;\n\n  var axLetter = ax._id.charAt(0);\n\n  var ann;\n  var attrPrefix;\n\n  function convert(attr) {\n    var currentVal = ann[attr];\n    var newVal = null;\n    if (toLog) newVal = toLogRange(currentVal, ax.range);else newVal = Math.pow(10, currentVal); // if conversion failed, delete the value so it gets a default value\n\n    if (!isNumeric(newVal)) newVal = null;\n    doExtra(attrPrefix + attr, newVal);\n  }\n\n  for (var i = 0; i < annotations.length; i++) {\n    ann = annotations[i];\n    attrPrefix = 'annotations[' + i + '].';\n    if (ann[axLetter + 'ref'] === ax._id) convert(axLetter);\n    if (ann['a' + axLetter + 'ref'] === ax._id) convert('a' + axLetter);\n  }\n};","map":null,"metadata":{},"sourceType":"script"}