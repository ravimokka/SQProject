{"ast":null,"code":"/**\n* Copyright 2012-2019, Plotly, Inc.\n* All rights reserved.\n*\n* This source code is licensed under the MIT license found in the\n* LICENSE file in the root directory of this source tree.\n*/\n'use strict';\n\nvar Lib = require('../../lib');\n\nvar BADNUM = require('../../constants/numerical').BADNUM;\n\nmodule.exports = function convertColumnData(trace, ax1, ax2, var1Name, var2Name, arrayVarNames) {\n  var colLen = trace._length;\n  var col1 = ax1.makeCalcdata(trace, var1Name);\n  var col2 = ax2.makeCalcdata(trace, var2Name);\n  var textCol = trace.text;\n  var hasColumnText = textCol !== undefined && Lib.isArray1D(textCol);\n  var hoverTextCol = trace.hovertext;\n  var hasColumnHoverText = hoverTextCol !== undefined && Lib.isArray1D(hoverTextCol);\n  var i, j;\n  var col1dv = Lib.distinctVals(col1);\n  var col1vals = col1dv.vals;\n  var col2dv = Lib.distinctVals(col2);\n  var col2vals = col2dv.vals;\n  var newArrays = [];\n  var text;\n  var hovertext;\n\n  for (i = 0; i < arrayVarNames.length; i++) {\n    newArrays[i] = Lib.init2dArray(col2vals.length, col1vals.length);\n  }\n\n  if (hasColumnText) {\n    text = Lib.init2dArray(col2vals.length, col1vals.length);\n  }\n\n  if (hasColumnHoverText) {\n    hovertext = Lib.init2dArray(col2vals.length, col1vals.length);\n  }\n\n  for (i = 0; i < colLen; i++) {\n    if (col1[i] !== BADNUM && col2[i] !== BADNUM) {\n      var i1 = Lib.findBin(col1[i] + col1dv.minDiff / 2, col1vals);\n      var i2 = Lib.findBin(col2[i] + col2dv.minDiff / 2, col2vals);\n\n      for (j = 0; j < arrayVarNames.length; j++) {\n        var arrayVarName = arrayVarNames[j];\n        var arrayVar = trace[arrayVarName];\n        var newArray = newArrays[j];\n        newArray[i2][i1] = arrayVar[i];\n      }\n\n      if (hasColumnText) text[i2][i1] = textCol[i];\n      if (hasColumnHoverText) hovertext[i2][i1] = hoverTextCol[i];\n    }\n  }\n\n  trace['_' + var1Name] = col1vals;\n  trace['_' + var2Name] = col2vals;\n\n  for (j = 0; j < arrayVarNames.length; j++) {\n    trace['_' + arrayVarNames[j]] = newArrays[j];\n  }\n\n  if (hasColumnText) trace._text = text;\n  if (hasColumnHoverText) trace._hovertext = hovertext;\n\n  if (ax1 && ax1.type === 'category') {\n    trace['_' + var1Name + 'CategoryMap'] = col1vals.map(function (v) {\n      return ax1._categories[v];\n    });\n  }\n\n  if (ax2 && ax2.type === 'category') {\n    trace['_' + var2Name + 'CategoryMap'] = col2vals.map(function (v) {\n      return ax2._categories[v];\n    });\n  }\n};","map":null,"metadata":{},"sourceType":"script"}